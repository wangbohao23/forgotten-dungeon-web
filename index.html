<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>é—å¿˜åœ°ç‰¢ | Forgotten Dungeon</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        @import url('https://fonts.googleapis.com/css2?family=VT323&display=swap');

        body {
            font-family: 'Courier New', 'VT323', monospace;
            background: linear-gradient(135deg, #0d0d0d 0%, #1a1a2e 50%, #16213e 100%);
            min-height: 100vh;
            color: #00ff41;
            overflow-x: hidden;
        }

        /* CRT å±å¹•æ•ˆæœ */
        .crt-container {
            position: relative;
            min-height: 100vh;
            padding: 20px;
        }

        .crt-container::before {
            content: "";
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: repeating-linear-gradient(
                0deg,
                rgba(0, 0, 0, 0.1),
                rgba(0, 0, 0, 0.1) 1px,
                transparent 1px,
                transparent 2px
            );
            pointer-events: none;
            z-index: 1000;
        }

        .crt-container::after {
            content: "";
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: radial-gradient(circle at center, transparent 50%, rgba(0, 0, 0, 0.4) 100%);
            pointer-events: none;
            z-index: 999;
        }

        /* ä¸»å®¹å™¨ */
        .game-container {
            max-width: 1200px;
            margin: 0 auto;
            display: grid;
            grid-template-columns: 280px 1fr;
            gap: 20px;
            height: calc(100vh - 40px);
        }

        /* ä¾§è¾¹æ  - ç©å®¶çŠ¶æ€ */
        .sidebar {
            background: rgba(0, 20, 0, 0.8);
            border: 2px solid #00ff41;
            border-radius: 10px;
            padding: 20px;
            display: flex;
            flex-direction: column;
            gap: 20px;
            box-shadow: 0 0 20px rgba(0, 255, 65, 0.2), inset 0 0 20px rgba(0, 255, 65, 0.05);
        }

        .sidebar h2 {
            color: #00ff41;
            font-size: 24px;
            text-align: center;
            border-bottom: 1px solid #00ff41;
            padding-bottom: 10px;
            text-shadow: 0 0 10px #00ff41;
        }

        .stat-box {
            background: rgba(0, 40, 0, 0.5);
            border: 1px solid #008f11;
            border-radius: 5px;
            padding: 15px;
        }

        .stat-box h3 {
            color: #00cc33;
            font-size: 16px;
            margin-bottom: 10px;
            text-transform: uppercase;
        }

        .stat-row {
            display: flex;
            justify-content: space-between;
            margin: 5px 0;
            font-size: 14px;
        }

        .stat-label {
            color: #888;
        }

        .stat-value {
            color: #00ff41;
            font-weight: bold;
        }

        /* HP æ¡ */
        .hp-bar-container {
            margin-top: 5px;
        }

        .hp-bar {
            width: 100%;
            height: 20px;
            background: #1a1a1a;
            border: 1px solid #333;
            border-radius: 3px;
            overflow: hidden;
        }

        .hp-fill {
            height: 100%;
            background: linear-gradient(90deg, #ff3333, #ff6600, #00ff41);
            transition: width 0.3s ease;
        }

        .hp-text {
            text-align: center;
            font-size: 12px;
            margin-top: 5px;
            color: #00ff41;
        }

        /* èƒŒåŒ… */
        .inventory-list {
            max-height: 200px;
            overflow-y: auto;
        }

        .inventory-item {
            padding: 8px;
            margin: 5px 0;
            background: rgba(0, 60, 0, 0.3);
            border-left: 3px solid #00ff41;
            font-size: 13px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .inventory-item:hover {
            background: rgba(0, 100, 0, 0.5);
            transform: translateX(5px);
        }

        .inventory-item .item-name {
            color: #00ff41;
            font-weight: bold;
        }

        .inventory-item .item-desc {
            color: #888;
            font-size: 11px;
            margin-top: 3px;
        }

        /* ä¸»æ¸¸æˆåŒºåŸŸ */
        .main-area {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        /* åœºæ™¯æè¿°åŒºåŸŸ */
        .scene-panel {
            background: rgba(0, 10, 0, 0.9);
            border: 2px solid #00ff41;
            border-radius: 10px;
            padding: 25px;
            flex: 1;
            overflow-y: auto;
            box-shadow: 0 0 30px rgba(0, 255, 65, 0.15), inset 0 0 30px rgba(0, 255, 65, 0.03);
        }

        .location-title {
            color: #00ff41;
            font-size: 28px;
            margin-bottom: 20px;
            text-shadow: 0 0 15px #00ff41;
            border-bottom: 2px solid #00ff41;
            padding-bottom: 10px;
        }

        .scene-description {
            color: #b3ffb3;
            font-size: 16px;
            line-height: 1.8;
            margin-bottom: 20px;
        }

        /* æ¸¸æˆæ—¥å¿— */
        .log-panel {
            background: rgba(0, 5, 0, 0.95);
            border: 1px solid #008f11;
            border-radius: 8px;
            padding: 15px;
            height: 200px;
            overflow-y: auto;
        }

        .log-entry {
            margin: 8px 0;
            padding: 8px 12px;
            border-radius: 4px;
            font-size: 14px;
            animation: fadeIn 0.3s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .log-entry.info {
            background: rgba(0, 50, 100, 0.3);
            border-left: 3px solid #0088ff;
            color: #88ccff;
        }

        .log-entry.combat {
            background: rgba(100, 0, 0, 0.3);
            border-left: 3px solid #ff3333;
            color: #ff8888;
        }

        .log-entry.success {
            background: rgba(0, 100, 0, 0.3);
            border-left: 3px solid #00ff41;
            color: #88ff88;
        }

        .log-entry.loot {
            background: rgba(100, 100, 0, 0.3);
            border-left: 3px solid #ffff00;
            color: #ffff88;
        }

        /* è¾“å…¥åŒºåŸŸ */
        .input-panel {
            background: rgba(0, 20, 0, 0.9);
            border: 2px solid #00ff41;
            border-radius: 10px;
            padding: 15px 20px;
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .prompt {
            color: #00ff41;
            font-size: 18px;
            font-weight: bold;
            white-space: nowrap;
        }

        .command-input {
            flex: 1;
            background: rgba(0, 40, 0, 0.5);
            border: 1px solid #00ff41;
            border-radius: 5px;
            padding: 12px 15px;
            color: #00ff41;
            font-family: 'Courier New', monospace;
            font-size: 16px;
            outline: none;
            transition: all 0.2s;
        }

        .command-input:focus {
            box-shadow: 0 0 15px rgba(0, 255, 65, 0.4);
            background: rgba(0, 60, 0, 0.7);
        }

        .command-input::placeholder {
            color: #005511;
        }

        .btn {
            background: linear-gradient(180deg, #003300, #001100);
            border: 2px solid #00ff41;
            color: #00ff41;
            padding: 12px 25px;
            border-radius: 5px;
            cursor: pointer;
            font-family: 'Courier New', monospace;
            font-size: 16px;
            font-weight: bold;
            transition: all 0.2s;
            text-transform: uppercase;
        }

        .btn:hover {
            background: linear-gradient(180deg, #00ff41, #008f11);
            color: #000;
            box-shadow: 0 0 20px rgba(0, 255, 65, 0.5);
        }

        /* å¿«æ·æŒ‰é’® */
        .quick-actions {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            margin-top: 10px;
        }

        .quick-btn {
            background: rgba(0, 50, 0, 0.5);
            border: 1px solid #008f11;
            color: #00cc33;
            padding: 8px 15px;
            border-radius: 4px;
            cursor: pointer;
            font-family: 'Courier New', monospace;
            font-size: 13px;
            transition: all 0.2s;
        }

        .quick-btn:hover {
            background: rgba(0, 100, 0, 0.7);
            border-color: #00ff41;
            color: #00ff41;
        }

        /* ä¿å­˜/åŠ è½½æŒ‰é’® */
        .save-controls {
            margin-top: auto;
            display: flex;
            gap: 10px;
        }

        .save-controls .btn {
            flex: 1;
            padding: 10px;
            font-size: 14px;
        }

        /* æ»šåŠ¨æ¡æ ·å¼ */
        ::-webkit-scrollbar {
            width: 8px;
        }

        ::-webkit-scrollbar-track {
            background: #0d0d0d;
        }

        ::-webkit-scrollbar-thumb {
            background: #00ff41;
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: #00cc33;
        }

        /* é—ªçƒå…‰æ ‡ */
        .cursor {
            display: inline-block;
            width: 10px;
            height: 20px;
            background: #00ff41;
            animation: blink 1s infinite;
            vertical-align: middle;
        }

        @keyframes blink {
            0%, 50% { opacity: 1; }
            51%, 100% { opacity: 0; }
        }

        /* å“åº”å¼ */
        @media (max-width: 900px) {
            .game-container {
                grid-template-columns: 1fr;
                grid-template-rows: auto 1fr;
            }
            
            .sidebar {
                flex-direction: row;
                flex-wrap: wrap;
            }
            
            .stat-box {
                flex: 1;
                min-width: 150px;
            }
        }

        /* æ ‡é¢˜åŠ¨ç”» */
        .game-title {
            text-align: center;
            font-size: 14px;
            color: #005511;
            margin-bottom: 10px;
            letter-spacing: 3px;
        }

        /* æ•Œäººæ˜¾ç¤º */
        .enemy-display {
            background: rgba(50, 0, 0, 0.3);
            border: 1px solid #ff3333;
            border-radius: 5px;
            padding: 15px;
            margin: 15px 0;
            display: none;
        }

        .enemy-display.active {
            display: block;
            animation: enemyAppear 0.5s ease;
        }

        @keyframes enemyAppear {
            from { 
                opacity: 0; 
                transform: scale(0.9);
            }
            to { 
                opacity: 1; 
                transform: scale(1);
            }
        }

        .enemy-name {
            color: #ff3333;
            font-size: 20px;
            font-weight: bold;
            text-shadow: 0 0 10px #ff3333;
        }

        .enemy-hp-bar {
            width: 100%;
            height: 15px;
            background: #1a0000;
            border: 1px solid #ff3333;
            border-radius: 3px;
            overflow: hidden;
            margin-top: 8px;
        }

        .enemy-hp-fill {
            height: 100%;
            background: linear-gradient(90deg, #660000, #ff3333);
            transition: width 0.3s ease;
        }

        /* æ–¹å‘æŒ‰é’® */
        .directions {
            display: flex;
            gap: 10px;
            margin-top: 15px;
            justify-content: center;
        }

        .dir-btn {
            width: 50px;
            height: 50px;
            background: rgba(0, 40, 0, 0.7);
            border: 2px solid #00ff41;
            color: #00ff41;
            font-size: 20px;
            cursor: pointer;
            border-radius: 5px;
            transition: all 0.2s;
        }

        .dir-btn:hover:not(:disabled) {
            background: #00ff41;
            color: #000;
        }

        .dir-btn:disabled {
            opacity: 0.3;
            cursor: not-allowed;
        }
    </style>
</head>
<body>
    <div class="crt-container">
        <div class="game-title">â•â•â• FORGOTTEN DUNGEON v1.0 â•â•â•</div>
        <div class="game-container">
            <!-- ä¾§è¾¹æ  -->
            <aside class="sidebar">
                <h2>ğŸ­ è§’è‰²çŠ¶æ€</h2>
                
                <div class="stat-box">
                    <h3>ğŸ“Š åŸºç¡€å±æ€§</h3>
                    <div class="stat-row">
                        <span class="stat-label">åç§°:</span>
                        <span class="stat-value" id="player-name">æ— åå†’é™©è€…</span>
                    </div>
                    <div class="stat-row">
                        <span class="stat-label">ç­‰çº§:</span>
                        <span class="stat-value" id="player-level">1</span>
                    </div>
                    <div class="stat-row">
                        <span class="stat-label">ç»éªŒ:</span>
                        <span class="stat-value" id="player-xp">0</span>
                    </div>
                    <div class="stat-row">
                        <span class="stat-label">é‡‘å¸:</span>
                        <span class="stat-value" id="player-gold">0</span>
                    </div>
                </div>

                <div class="stat-box">
                    <h3>â¤ï¸ ç”Ÿå‘½å€¼</h3>
                    <div class="hp-bar-container">
                        <div class="hp-bar">
                            <div class="hp-fill" id="hp-bar" style="width: 100%"></div>
                        </div>
                        <div class="hp-text"><span id="current-hp">100</span> / <span id="max-hp">100</span> HP</div>
                    </div>
                </div>

                <div class="stat-box">
                    <h3>ğŸ’ èƒŒåŒ…</h3>
                    <div class="inventory-list" id="inventory-list">
                        <!-- åŠ¨æ€ç”Ÿæˆ -->
                    </div>
                </div>

                <div class="save-controls">
                    <button class="btn" onclick="game.saveGame()">ğŸ’¾ ä¿å­˜</button>
                    <button class="btn" onclick="game.loadGame()">ğŸ“‚ åŠ è½½</button>
                </div>
            </aside>

            <!-- ä¸»æ¸¸æˆåŒºåŸŸ -->
            <main class="main-area">
                <!-- åœºæ™¯æè¿° -->
                <div class="scene-panel" id="scene-panel">
                    <h1 class="location-title" id="location-title">ğŸšª åœ°ç‰¢å…¥å£</h1>
                    <div class="scene-description" id="scene-description">
                        åŠ è½½ä¸­...
                    </div>
                    
                    <!-- æ•Œäººæ˜¾ç¤º -->
                    <div class="enemy-display" id="enemy-display">
                        <div class="enemy-name" id="enemy-name">æ²¼æ³½å·¨é¼ </div>
                        <div class="enemy-hp-bar">
                            <div class="enemy-hp-fill" id="enemy-hp-bar" style="width: 100%"></div>
                        </div>
                    </div>

                    <!-- æ–¹å‘æ§åˆ¶ -->
                    <div class="directions">
                        <button class="dir-btn" id="btn-north" onclick="game.move('north')">åŒ—</button>
                        <button class="dir-btn" id="btn-south" onclick="game.move('south')">å—</button>
                        <button class="dir-btn" id="btn-east" onclick="game.move('east')">ä¸œ</button>
                        <button class="dir-btn" id="btn-west" onclick="game.move('west')">è¥¿</button>
                    </div>
                </div>

                <!-- æ¸¸æˆæ—¥å¿— -->
                <div class="log-panel" id="log-panel">
                    <!-- åŠ¨æ€ç”Ÿæˆ -->
                </div>

                <!-- è¾“å…¥åŒºåŸŸ -->
                <div class="input-panel">
                    <span class="prompt">&gt;<span class="cursor"></span></span>
                    <input type="text" class="command-input" id="command-input" placeholder="è¾“å…¥å‘½ä»¤ (å¦‚: æ”»å‡», å»ä¸œè¾¹, æ£€æŸ¥è¢‹å­...)" autocomplete="off">
                    <button class="btn" onclick="game.executeCommand()">æ‰§è¡Œ</button>
                </div>

                <!-- å¿«æ·æŒ‰é’® -->
                <div class="quick-actions">
                    <button class="quick-btn" onclick="game.quickCommand('æ£€æŸ¥')">ğŸ” æ£€æŸ¥</button>
                    <button class="quick-btn" onclick="game.quickCommand('æ”»å‡»')">âš”ï¸ æ”»å‡»</button>
                    <button class="quick-btn" onclick="game.quickCommand('èƒŒåŒ…')">ğŸ’ èƒŒåŒ…</button>
                    <button class="quick-btn" onclick="game.quickCommand('çŠ¶æ€')">ğŸ“Š çŠ¶æ€</button>
                    <button class="quick-btn" onclick="game.quickCommand('å¸®åŠ©')">â“ å¸®åŠ©</button>
                </div>
            </main>
        </div>
    </div>

    <script>
        // æ¸¸æˆæ•°æ®
        const LOCATIONS = {
            entrance: {
                id: 'entrance',
                name: 'ğŸšª åœ°ç‰¢å…¥å£',
                description: `ä½ ç«™åœ¨ä¸€ä¸ªé˜´æš—æ½®æ¹¿çš„çŸ³å®¤é‡Œï¼Œè¿™é‡Œä¼¼ä¹æ˜¯åœ°ç‰¢çš„å…¥å£ã€‚

å››å‘¨çš„çŸ³å¢™è¦†ç›–ç€é’è‹”ï¼Œç©ºæ°”ä¸­å¼¥æ¼«ç€è…æœ½çš„æ°”å‘³ã€‚å¾®å¼±çš„ç«æŠŠå…‰èŠ’åœ¨å¢™ä¸ŠæŠ•ä¸‹è¯¡å¼‚çš„é˜´å½±ã€‚

åœ¨ä½ é¢å‰æœ‰ä¸‰æ¡é€šé“ï¼š
â€¢ å·¦ä¾§æ˜¯ä¸€æ¡å‘ä¸‹çš„çŸ³é˜¶ï¼Œé€šå‘é»‘æš—æ·±å¤„
â€¢ ä¸­é—´æ˜¯ä¸€æ¡ç‹­çª„çš„èµ°å»Šï¼Œéšçº¦èƒ½å¬åˆ°æ»´æ°´å£°
â€¢ å³ä¾§æ˜¯ä¸€ä¸ªé»‘æš—çš„æ´å£ï¼Œæœ‰å†·é£ä»ä¸­å¹å‡º`,
                exits: { south: 'dripping_corridor' },
                items: [],
                enemy: null
            },
            dripping_corridor: {
                id: 'dripping_corridor',
                name: 'ğŸ’§ æ»´æ°´é€šé“',
                description: `ä½ æ¥åˆ°äº†ä¸€æ¡ç‹­é•¿çš„é€šé“ï¼Œå¤´é¡¶ä¸æ–­æœ‰æ°´æ»´è½ä¸‹ã€‚

é€šé“ä¸¤ä¾§çš„å¢™å£æ¹¿æ»‘éš¾è¡Œï¼Œåœ°é¢ä¸Šç§¯ç€æµ…æµ…çš„æ°´æ´¼ã€‚è¿œå¤„ä¼ æ¥çª¸çª¸çª£çª£çš„å£°éŸ³ï¼Œåƒæ˜¯æœ‰ä»€ä¹ˆä¸œè¥¿åœ¨é»‘æš—ä¸­ç§»åŠ¨...

åœ¨é€šé“å°½å¤´ï¼Œä½ çœ‹åˆ°ï¼š
â€¢ ä¸€ä¸ªç ´æ—§çš„å¸ƒè¢‹é åœ¨å¢™è¾¹
â€¢ å¢™ä¸Šæœ‰ä¸€é“è£‚ç¼ï¼Œä¼¼ä¹å¯ä»¥é€šå‘åˆ«å¤„
â€¢ å‰æ–¹æœ‰æ›´å®½é˜”çš„ç©ºé—´`,
                exits: { north: 'entrance', east: 'hidden_chamber' },
                items: [
                    { id: 'ancient_coin', name: 'å¤æ—§é“œå¸', type: 'misc', description: 'ä¸€æšåˆ»æœ‰å¥‡æ€ªç¬¦æ–‡çš„é“œå¸' }
                ],
                enemy: {
                    id: 'swamp_rat',
                    name: 'æ²¼æ³½å·¨é¼ ',
                    hp: 40,
                    maxHp: 40,
                    damage: 8,
                    xp: 15,
                    loot: [
                        { id: 'rat_tail', name: 'æ²¼æ³½å·¨é¼ å°¾å·´', type: 'material', description: 'æ¹¿æ¼‰æ¼‰çš„è€é¼ å°¾å·´' }
                    ]
                }
            },
            hidden_chamber: {
                id: 'hidden_chamber',
                name: 'ğŸ—ï¸ éšç§˜å¯†å®¤',
                description: `ä½ å‘ç°äº†ä¸€ä¸ªéšè—åœ¨å¢™åçš„å°å¯†å®¤ï¼

è¿™é‡Œæ¯”å¤–é¢å¹²ç‡¥è®¸å¤šï¼Œå¢™ä¸Šåˆ»æ»¡äº†å¤è€çš„ç¬¦æ–‡ã€‚å¯†å®¤ä¸­å¤®æœ‰ä¸€ä¸ªçŸ³å°ï¼Œä¸Šé¢æ‘†æ”¾ç€ä¸€äº›ç‰©å“ã€‚

åœ¨å¯†å®¤çš„ä¸€è§’ï¼Œä½ å‘ç°ï¼š
â€¢ ä¸€å…·å¤è€çš„éª·é«…ï¼Œæ‰‹ä¸­æ¡ç€ä»€ä¹ˆä¸œè¥¿
â€¢ ä¸€ä¸ªä¸Šé”çš„ç®±å­
â€¢ å¢™ä¸Šæœ‰ä¸€å¹…è¤ªè‰²çš„å£ç”»ï¼Œæç»˜ç€æŸç§ä»ªå¼`,
                exits: { west: 'dripping_corridor' },
                items: [
                    { id: 'healing_potion_small', name: 'å°å‹æ²»ç–—è¯æ°´', type: 'consumable', heal: 30, quantity: 1, description: 'çº¢è‰²æ¶²ä½“åœ¨ç“¶ä¸­å¾®å¾®å‘å…‰' },
                    { id: 'bread', name: 'ç¡¬é¢åŒ…', type: 'consumable', heal: 20, quantity: 1, description: 'èƒ½å¡«é¥±è‚šå­ï¼Œè™½ç„¶ç¡¬å¾—åƒçŸ³å¤´' }
                ],
                enemy: null
            }
        };

        // æ¸¸æˆç±»
        class ForgottenDungeon {
            constructor() {
                this.player = {
                    name: 'æ— åå†’é™©è€…',
                    level: 1,
                    hp: 100,
                    maxHp: 100,
                    xp: 0,
                    xpToNext: 100,
                    gold: 10,
                    inventory: [
                        { id: 'rusty_dagger', name: 'ç”Ÿé”ˆçš„åŒ•é¦–', type: 'weapon', damage: 5, description: 'ä¸€æŠŠé”ˆè¿¹æ–‘æ–‘çš„åŒ•é¦–ï¼Œä½†æ€»æ¯”ç©ºæ‰‹å¼º' }
                    ]
                };
                this.currentLocation = 'entrance';
                this.discoveredLocations = ['entrance'];
                this.flags = {};
                this.logs = [];
                this.currentEnemy = null;
                this.inCombat = false;
                
                this.init();
            }

            init() {
                this.updateUI();
                this.addLog('æ¬¢è¿æ¥åˆ°é—å¿˜åœ°ç‰¢ï¼è¾“å…¥"å¸®åŠ©"æŸ¥çœ‹å¯ç”¨å‘½ä»¤ã€‚', 'info');
                this.renderScene();
                
                // ç»‘å®šå›è½¦é”®
                document.getElementById('command-input').addEventListener('keypress', (e) => {
                    if (e.key === 'Enter') {
                        this.executeCommand();
                    }
                });
            }

            renderScene() {
                const location = LOCATIONS[this.currentLocation];
                document.getElementById('location-title').textContent = location.name;
                document.getElementById('scene-description').textContent = location.description;
                
                // æ›´æ–°æ–¹å‘æŒ‰é’®
                const directions = ['north', 'south', 'east', 'west'];
                directions.forEach(dir => {
                    const btn = document.getElementById(`btn-${dir}`);
                    if (location.exits[dir]) {
                        btn.disabled = false;
                        btn.style.opacity = '1';
                    } else {
                        btn.disabled = true;
                        btn.style.opacity = '0.3';
                    }
                });

                // æ£€æŸ¥æ•Œäºº
                if (location.enemy && !this.flags[`defeated_${location.enemy.id}`]) {
                    this.startCombat(location.enemy);
                } else {
                    this.endCombat();
                }
            }

            startCombat(enemy) {
                this.currentEnemy = { ...enemy, currentHp: enemy.hp };
                this.inCombat = true;
                
                const enemyDisplay = document.getElementById('enemy-display');
                enemyDisplay.classList.add('active');
                document.getElementById('enemy-name').textContent = `âš”ï¸ ${enemy.name}`;
                this.updateEnemyHp();
                
                this.addLog(`é­é‡äº† ${enemy.name}ï¼æˆ˜æ–—å¼€å§‹ï¼`, 'combat');
            }

            endCombat() {
                this.currentEnemy = null;
                this.inCombat = false;
                document.getElementById('enemy-display').classList.remove('active');
            }

            updateEnemyHp() {
                if (this.currentEnemy) {
                    const percent = (this.currentEnemy.currentHp / this.currentEnemy.maxHp) * 100;
                    document.getElementById('enemy-hp-bar').style.width = `${percent}%`;
                }
            }

            move(direction) {
                const location = LOCATIONS[this.currentLocation];
                const newLocation = location.exits[direction];
                
                if (newLocation) {
                    if (this.inCombat) {
                        this.addLog('æˆ˜æ–—ä¸­æ— æ³•ç§»åŠ¨ï¼', 'combat');
                        return;
                    }
                    
                    this.currentLocation = newLocation;
                    if (!this.discoveredLocations.includes(newLocation)) {
                        this.discoveredLocations.push(newLocation);
                    }
                    this.addLog(`ä½ å‘${this.getDirectionName(direction)}ç§»åŠ¨...`, 'info');
                    this.renderScene();
                } else {
                    this.addLog('é‚£ä¸ªæ–¹å‘æ²¡æœ‰è·¯ã€‚', 'info');
                }
            }

            getDirectionName(dir) {
                const names = { north: 'åŒ—', south: 'å—', east: 'ä¸œ', west: 'è¥¿' };
                return names[dir] || dir;
            }

            executeCommand() {
                const input = document.getElementById('command-input');
                const command = input.value.trim();
                
                if (!command) return;
                
                input.value = '';
                this.processCommand(command);
            }

            quickCommand(cmd) {
                document.getElementById('command-input').value = cmd;
                this.executeCommand();
            }

            processCommand(command) {
                const cmd = command.toLowerCase();
                
                // ç§»åŠ¨å‘½ä»¤
                if (cmd.includes('åŒ—') || cmd.includes('north')) {
                    this.move('north');
                    return;
                }
                if (cmd.includes('å—') || cmd.includes('south')) {
                    this.move('south');
                    return;
                }
                if (cmd.includes('ä¸œ') || cmd.includes('east')) {
                    this.move('east');
                    return;
                }
                if (cmd.includes('è¥¿') || cmd.includes('west')) {
                    this.move('west');
                    return;
                }

                // æ”»å‡»
                if (cmd.includes('æ”»å‡»') || cmd.includes('attack') || cmd.includes('æ‰“')) {
                    this.attack();
                    return;
                }

                // æ£€æŸ¥/æœç´¢
                if (cmd.includes('æ£€æŸ¥') || cmd.includes('æœç´¢') || cmd.includes('look') || cmd.includes('search')) {
                    this.search();
                    return;
                }

                // èƒŒåŒ…
                if (cmd.includes('èƒŒåŒ…') || cmd.includes('inventory') || cmd.includes('bag')) {
                    this.showInventory();
                    return;
                }

                // çŠ¶æ€
                if (cmd.includes('çŠ¶æ€') || cmd.includes('status') || cmd.includes('stats')) {
                    this.showStatus();
                    return;
                }

                // ä½¿ç”¨ç‰©å“
                if (cmd.includes('ä½¿ç”¨') || cmd.includes('use') || cmd.includes('å–') || cmd.includes('åƒ')) {
                    this.useItem(cmd);
                    return;
                }

                // æ‹¾å–
                if (cmd.includes('æ‹¾å–') || cmd.includes('æ¡') || cmd.includes('æ‹¿') || cmd.includes('take') || cmd.includes('pick')) {
                    this.pickupItem(cmd);
                    return;
                }

                // å¸®åŠ©
                if (cmd.includes('å¸®åŠ©') || cmd.includes('help') || cmd.includes('?')) {
                    this.showHelp();
                    return;
                }

                this.addLog(`æœªçŸ¥å‘½ä»¤: "${command}"ã€‚è¾“å…¥"å¸®åŠ©"æŸ¥çœ‹å¯ç”¨å‘½ä»¤ã€‚`, 'info');
            }

            attack() {
                if (!this.inCombat) {
                    this.addLog('è¿™é‡Œæ²¡æœ‰æ•Œäººå¯ä»¥æ”»å‡»ã€‚', 'info');
                    return;
                }

                // ç©å®¶æ”»å‡»
                const weapon = this.player.inventory.find(i => i.type === 'weapon');
                const damage = weapon ? weapon.damage + Math.floor(Math.random() * 3) : 2 + Math.floor(Math.random() * 2);
                
                this.currentEnemy.currentHp -= damage;
                this.addLog(`ä½ ç”¨${weapon ? weapon.name : 'æ‹³å¤´'}æ”»å‡» ${this.currentEnemy.name}ï¼Œé€ æˆ ${damage} ç‚¹ä¼¤å®³ï¼`, 'combat');
                this.updateEnemyHp();

                // æ£€æŸ¥æ•Œäººæ­»äº¡
                if (this.currentEnemy.currentHp <= 0) {
                    this.defeatEnemy();
                    return;
                }

                // æ•Œäººåå‡»
                setTimeout(() => {
                    const enemyDamage = Math.max(1, this.currentEnemy.damage - Math.floor(Math.random() * 3));
                    this.player.hp -= enemyDamage;
                    this.addLog(`${this.currentEnemy.name} åå‡»ï¼Œé€ æˆ ${enemyDamage} ç‚¹ä¼¤å®³ï¼`, 'combat');
                    
                    if (this.player.hp <= 0) {
                        this.player.hp = 0;
                        this.addLog('ä½ å€’ä¸‹äº†... æ¸¸æˆç»“æŸï¼', 'combat');
                        this.addLog('åˆ·æ–°é¡µé¢é‡æ–°å¼€å§‹ã€‚', 'info');
                    }
                    
                    this.updateUI();
                }, 500);
            }

            defeatEnemy() {
                const enemy = this.currentEnemy;
                this.addLog(`ä½ å‡»è´¥äº† ${enemy.name}ï¼`, 'success');
                this.addLog(`è·å¾— ${enemy.xp} ç»éªŒå€¼ï¼`, 'success');
                
                this.player.xp += enemy.xp;
                this.checkLevelUp();
                
                // æ‰è½ç‰©å“
                if (enemy.loot) {
                    enemy.loot.forEach(item => {
                        this.player.inventory.push(item);
                        this.addLog(`è·å¾—æˆ˜åˆ©å“: ${item.name}`, 'loot');
                    });
                }
                
                this.flags[`defeated_${enemy.id}`] = true;
                this.endCombat();
                this.updateUI();
            }

            checkLevelUp() {
                if (this.player.xp >= this.player.xpToNext) {
                    this.player.level++;
                    this.player.xp -= this.player.xpToNext;
                    this.player.xpToNext = Math.floor(this.player.xpToNext * 1.5);
                    this.player.maxHp += 20;
                    this.player.hp = this.player.maxHp;
                    this.addLog(`ğŸ‰ å‡çº§äº†ï¼ä½ ç°åœ¨ç­‰çº§ ${this.player.level}ï¼`, 'success');
                }
            }

            search() {
                const location = LOCATIONS[this.currentLocation];
                
                if (this.inCombat) {
                    this.addLog('æˆ˜æ–—ä¸­æ— æ³•æœç´¢ï¼', 'combat');
                    return;
                }

                // æœç´¢åœºæ™¯ç‰©å“
                if (location.items && location.items.length > 0) {
                    this.addLog('ä½ å‘ç°äº†:', 'info');
                    location.items.forEach(item => {
                        this.addLog(`  â€¢ ${item.name} - ${item.description}`, 'loot');
                    });
                    this.addLog('ä½¿ç”¨ "æ‹¾å– [ç‰©å“å]" æ¥æ‹¿å–ã€‚', 'info');
                } else {
                    this.addLog('ä½ ä»”ç»†æœç´¢äº†è¿™ä¸ªåŒºåŸŸï¼Œä½†æ²¡æœ‰å‘ç°ä»€ä¹ˆç‰¹åˆ«çš„ä¸œè¥¿ã€‚', 'info');
                }
            }

            pickupItem(cmd) {
                const location = LOCATIONS[this.currentLocation];
                
                if (!location.items || location.items.length === 0) {
                    this.addLog('è¿™é‡Œæ²¡æœ‰å¯ä»¥æ‹¾å–çš„ç‰©å“ã€‚', 'info');
                    return;
                }

                // ç®€å•å¤„ç†ï¼šæ‹¾å–æ‰€æœ‰ç‰©å“
                location.items.forEach(item => {
                    this.player.inventory.push(item);
                    this.addLog(`æ‹¾å–äº†: ${item.name}`, 'success');
                });
                location.items = [];
                this.updateUI();
            }

            useItem(cmd) {
                // æŸ¥æ‰¾æ¶ˆè€—å“
                const consumables = this.player.inventory.filter(i => i.type === 'consumable');
                
                if (consumables.length === 0) {
                    this.addLog('ä½ æ²¡æœ‰å¯ä»¥ä½¿ç”¨çš„æ¶ˆè€—å“ã€‚', 'info');
                    return;
                }

                // ä¼˜å…ˆä½¿ç”¨æ²»ç–—è¯æ°´
                const potion = consumables.find(i => i.id.includes('potion') || i.id.includes('healing'));
                if (potion) {
                    this.heal(potion.heal);
                    potion.quantity--;
                    if (potion.quantity <= 0) {
                        this.player.inventory = this.player.inventory.filter(i => i !== potion);
                    }
                    this.addLog(`ä½¿ç”¨äº† ${potion.name}ï¼Œæ¢å¤ ${potion.heal} HPï¼`, 'success');
                    this.updateUI();
                    return;
                }

                // ä½¿ç”¨é¢åŒ…
                const bread = consumables.find(i => i.id === 'bread');
                if (bread) {
                    this.heal(bread.heal);
                    bread.quantity--;
                    if (bread.quantity <= 0) {
                        this.player.inventory = this.player.inventory.filter(i => i !== bread);
                    }
                    this.addLog(`åƒæ‰äº† ${bread.name}ï¼Œæ¢å¤ ${bread.heal} HPï¼`, 'success');
                    this.updateUI();
                    return;
                }
            }

            heal(amount) {
                this.player.hp = Math.min(this.player.maxHp, this.player.hp + amount);
            }

            showInventory() {
                if (this.player.inventory.length === 0) {
                    this.addLog('ä½ çš„èƒŒåŒ…æ˜¯ç©ºçš„ã€‚', 'info');
                    return;
                }

                this.addLog('ğŸ’ èƒŒåŒ…å†…å®¹:', 'info');
                this.player.inventory.forEach(item => {
                    const qty = item.quantity ? ` x${item.quantity}` : '';
                    this.addLog(`  â€¢ ${item.name}${qty} - ${item.description}`, 'info');
                });
            }

            showStatus() {
                this.addLog('ğŸ“Š è§’è‰²çŠ¶æ€:', 'info');
                this.addLog(`  åç§°: ${this.player.name}`, 'info');
                this.addLog(`  ç­‰çº§: ${this.player.level}`, 'info');
                this.addLog(`  HP: ${this.player.hp}/${this.player.maxHp}`, 'info');
                this.addLog(`  ç»éªŒ: ${this.player.xp}/${this.player.xpToNext}`, 'info');
                this.addLog(`  é‡‘å¸: ${this.player.gold}`, 'info');
            }

            showHelp() {
                this.addLog('â“ å¯ç”¨å‘½ä»¤:', 'info');
                this.addLog('  ç§»åŠ¨: å»[æ–¹å‘], åŒ—/å—/ä¸œ/è¥¿', 'info');
                this.addLog('  æˆ˜æ–—: æ”»å‡», æ‰“', 'info');
                this.addLog('  æ¢ç´¢: æ£€æŸ¥, æœç´¢', 'info');
                this.addLog('  ç‰©å“: æ‹¾å–, ä½¿ç”¨, èƒŒåŒ…', 'info');
                this.addLog('  å…¶ä»–: çŠ¶æ€, å¸®åŠ©', 'info');
                this.addLog('', 'info');
                this.addLog('ğŸ’¡ æç¤º: åœ¨æˆ˜æ–—ä¸­æŒ‰"æ”»å‡»"æŒ‰é’®æˆ–è¾“å…¥"æ”»å‡»"', 'info');
            }

            addLog(message, type = 'info') {
                this.logs.push({ message, type });
                if (this.logs.length > 50) {
                    this.logs.shift();
                }
                this.renderLogs();
            }

            renderLogs() {
                const logPanel = document.getElementById('log-panel');
                logPanel.innerHTML = this.logs.map(log => 
                    `<div class="log-entry ${log.type}">${log.message}</div>`
                ).join('');
                logPanel.scrollTop = logPanel.scrollHeight;
            }

            updateUI() {
                // æ›´æ–°ç©å®¶ä¿¡æ¯
                document.getElementById('player-name').textContent = this.player.name;
                document.getElementById('player-level').textContent = this.player.level;
                document.getElementById('player-xp').textContent = `${this.player.xp}/${this.player.xpToNext}`;
                document.getElementById('player-gold').textContent = this.player.gold;
                document.getElementById('current-hp').textContent = this.player.hp;
                document.getElementById('max-hp').textContent = this.player.maxHp;

                // æ›´æ–°HPæ¡
                const hpPercent = (this.player.hp / this.player.maxHp) * 100;
                document.getElementById('hp-bar').style.width = `${hpPercent}%`;

                // æ›´æ–°èƒŒåŒ…
                const inventoryList = document.getElementById('inventory-list');
                if (this.player.inventory.length === 0) {
                    inventoryList.innerHTML = '<div style="color: #555; font-style: italic;">èƒŒåŒ…æ˜¯ç©ºçš„</div>';
                } else {
                    inventoryList.innerHTML = this.player.inventory.map(item => {
                        const qty = item.quantity ? ` x${item.quantity}` : '';
                        return `
                            <div class="inventory-item" onclick="game.quickCommand('ä½¿ç”¨ ${item.name}')">
                                <div class="item-name">${item.name}${qty}</div>
                                <div class="item-desc">${item.description}</div>
                            </div>
                        `;
                    }).join('');
                }
            }

            saveGame() {
                const saveData = {
                    player: this.player,
                    currentLocation: this.currentLocation,
                    discoveredLocations: this.discoveredLocations,
                    flags: this.flags,
                    logs: this.logs,
                    saveTime: new Date().toISOString()
                };
                
                localStorage.setItem('forgotten_dungeon_save', JSON.stringify(saveData));
                this.addLog('ğŸ’¾ æ¸¸æˆå·²ä¿å­˜ï¼', 'success');
            }

            loadGame() {
                const saveData = localStorage.getItem('forgotten_dungeon_save');
                
                if (!saveData) {
                    this.addLog('æ²¡æœ‰æ‰¾åˆ°å­˜æ¡£ã€‚', 'info');
                    return;
                }

                try {
                    const data = JSON.parse(saveData);
                    this.player = data.player;
                    this.currentLocation = data.currentLocation;
                    this.discoveredLocations = data.discoveredLocations;
                    this.flags = data.flags;
                    this.logs = data.logs || [];
                    
                    this.addLog(`ğŸ“‚ æ¸¸æˆå·²åŠ è½½ï¼(å­˜æ¡£æ—¶é—´: ${new Date(data.saveTime).toLocaleString()})`, 'success');
                    this.renderScene();
                    this.updateUI();
                } catch (e) {
                    this.addLog('å­˜æ¡£æŸåï¼Œæ— æ³•åŠ è½½ã€‚', 'combat');
                }
            }
        }

        // å¯åŠ¨æ¸¸æˆ
        const game = new ForgottenDungeon();
    </script>
</body>
</html>
